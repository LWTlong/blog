---
title: mongodb 的数据库设计
order: 6
#article: false
category:
  - Nodejs
  - mongodb
tag:
  - mongodb
---

在 mongodb 的数据库设计中，需要我们抛弃之前使用关系型数据库的设计思维。

它是没有规则、没有表关系的，非常灵活的。当然这很难，不过你把它视为 json 来看就好了。

唯一的问题是，当数据产生关系的时候，是选择 **内嵌** 还是 **引用**

## 内嵌

内嵌就是直接存在单个集合里，例如 `students` 表:

```json
{
  "id": "学生id",
  "name": "姓名",
  "age": "年龄",
  "club": [
    {
      "name": "社团名",
      "id": "社团id"
    }
  ],
  "classInfo": {
    "id": "年级id",
    "name": "年级名称"
  }
}
```

### 内嵌的优势

- 只需要一次查询就可以查询到所有的信息
- 只需要一个操作就可以更新多个信息
- 避免了多集合查询

### 内嵌的劣势

- 单个文档太大，查询可能更加的耗时，获得的无关信息增大
- 针对每个文档，mongodb 有一个 16M 的最大限制，内嵌太多，可能超过限制


## 引用

引用就是常用的建立表关系，虽然 mongodb 没有外键约束，但是可以手动的创建字段来作为表之间的关联性。

### 引用的优势

- 将数据分散到不同的文档，数据量会变小
- 不太会超过最大 16M 的限制
- 每次查询取得的无关数据的概览降低

### 引用的劣势

- 需要多集合查询才能获得最终数据


关于设计，不要教条主义，怎么样去设计一个数据，还是要看自己的具体业务。
