---
title: 对象的克隆
order: 4
#article: false
tag:
  - JavaScript
---

克隆的意义和常见场景:

- 意义： 保证原数据的完整性和独立性
- 常见场景： 复制数据，函数入参，class 构造函数等

## 浅克隆

只克隆对象的第一层级，如果属性值是原始数据类似，拷贝其值，也就是常说的值拷贝，
如果属性值是引用类型，拷贝其内存地址，也就是常说的引用拷贝。

#### 对象常用浅克隆方法

- ES6 扩展运算符 ...
- Object.assign
- for in 和其他的一层级的遍历

#### 数组常用浅克隆

- ES6 扩展运算符 ...
- slice
- [].concat

## 深度克隆

克隆对象的每个层级, 如果属性值是原始数据类似，拷贝其值，也就是常说的值拷贝, 如果属性值是引用类型，递归克隆。

#### JSON.stringify JSON.parse

- 优点：纯天然 无污染
- 局限性：只能复制普通键的属性，Symbol 类型的无能为力
- 循环引用对象，比如 window 不能复制
- 特殊值类型，不能复制，比如 Function | Date | Blob 等
- 而且性能偏差

#### 消息通讯

- Broadcast Channel
- window.postMessage
- Shared Worker
- Message Channel
- 对对象的克隆很强大，不能克隆函数和循环引用
- 同步会变成异步，需要用 Promise 包装

消息通讯克隆，其实很少用，几乎都没怎么听说，目前这里虽然列出来，但是我也是浅尝即止。

目前大部分深拷贝，要么自己手写，要么用比如 lodash 这些工具库提供的方法，其实 99% 还是用工具库的方法，毕竟自己手写一个完美的深拷贝，光是处理各种特殊数据类型就够头痛了，哈哈哈。
